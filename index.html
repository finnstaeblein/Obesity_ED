<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Obesity Crisis</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/d3-geo.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v3.min.js"></script>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Hero Section -->
    <section id="hero-section" class="hero-section">
      <div class="hero-content">
        <h1 class="hero-title">Running in Place:<br>The Myth Around Solving Obesity</h1>
        <p class="card-text">Obesity has surged around the world for more than forty years. Before exploring possible explanations, it's worth seeing the trend for yourself, and how different countries have moved along it.</p>
        <div class="scroll-cta">
          <button id="explore-now-btn" class="explore-now-btn">
            <span class="explore-text">Explore Now</span>
            <div class="explore-arrow">
              <svg viewBox="0 0 24 24" fill="none" stroke="#f4d9a6" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5 L12 19 M6 13 L12 19 L18 13"/>
              </svg>
            </div>
          </button>
        </div>
      </div>
    </section>

    <!-- Map Section -->
    <section id="map-section" class="graph-section">
      <div class="split-layout">
        <div class="graph-side">
          <div class="chart-wrapper">
            <div id="world-map"></div>
            <div class="trend-section-divider">
              <div id="multi-country-trend"></div>
            </div>
          </div>
        </div>
        <div class="content-side">
          <div class="content-card active" data-step="0">
            <div class="card-content">
              <div class="step-indicator">1/4</div>
              <p class="card-text">
                Obesity rates vary dramatically around the world. Some countries have rates below 5%, while others exceed 35%.
              </p>
              <div class="timeline-controls">
                <button id="play-btn" class="play-btn">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path id="play-icon" d="M8 5v14l11-7z"/>
                    <path id="pause-icon" d="M6 4h4v16H6zm8 0h4v16h-4z" style="display: none;"/>
                  </svg>
                  <span id="play-text">Play Timeline</span>
                </button>
                <div class="year-display">
                  <span id="current-year">2022</span>
                </div>
              </div>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="map-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="map-section">Next →</button>
              </div>
            </div>
          </div>
          <div class="content-card" data-step="1">
            <div class="card-content">
              <div class="step-indicator">2/6</div>
              <p class="card-text">
                Over the past 50 years, obesity has been rapidly increasing worldwide, especially in developed nations.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="map-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="map-section">Next →</button>
              </div>
            </div>
          </div>
          <div class="content-card" data-step="2">
            <div class="card-content">
              <div class="step-indicator">3/6</div>
              <p class="card-text card-text-bold">
                The United States has one of the highest obesity rates in the world at <span class="text-highlight">36.2%</span>.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="map-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="map-section">Next →</button>
              </div>
            </div>
          </div>
          <div class="content-card" data-step="3">
            <div class="card-content">
              <div class="step-indicator">4/4</div>
              <h4 class="card-title">Customize Trends</h4>
              <div class="trend-filters-in-card">
                <div class="filter-group">
                  <label class="filter-label">Age Group:</label>
                  <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="age" data-value="adults">Adults</button>
                    <button class="filter-btn" data-filter="age" data-value="children">Children</button>
                  </div>
                </div>
                <div class="filter-group">
                  <label class="filter-label">Countries:</label>
                  <div class="country-checkboxes" id="country-filters"></div>
                </div>
                <div class="filter-group">
                  <label class="filter-label">Year Range:</label>
                  <div class="year-range-controls">
                    <input type="range" id="year-start" min="1975" max="2022" value="1975" step="5">
                    <span id="year-start-label">1975</span>
                    <span>to</span>
                    <input type="range" id="year-end" min="1975" max="2022" value="2022" step="5">
                    <span id="year-end-label">2022</span>
                  </div>
                </div>
              </div>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="map-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="map-section">Next →</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Combined Question Section -->
    <section id="combined-question-section" class="graph-section">
      <div class="split-layout question-split-layout">
        <div class="question-card-side">
          <div class="content-card active" data-step="0">
            <div class="card-content question-card-content">
              <div class="step-indicator">1/2</div>
              <h2 class="section-heading">What is causing this rise? </h2>
              <p class="card-text">
                At its core, obesity occurs when energy intake is consistently higher than energy expenditure. The harder question is which side of this balance has changed in modern populations. Public health organizations typically point to two possibilities: people may be burning less energy through daily activity, or they may be consuming more energy as diets shift. <a href="#source-1" class="footnote-link">[1]</a> </p>

              <h2 class="card-title">What do most Americans say is a very important reason many Americans are very overweight?</h2>
              <div class="options-container">
                <button class="option-button" data-option="exercise">Not getting enough exercise</button>
                <button class="option-button" data-option="diet">Eating too much or lack of willpower</button>
                <button class="option-button" data-option="food">The kinds of foods available or marketed</button>
                <button class="option-button" data-option="genetics">Genetics and hereditary factors</button>
              </div>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="combined-question-section" disabled>← Previous</button>
                <button class="nav-btn next-btn" data-section="combined-question-section" id="belief-next-btn" disabled>Next →</button>
              </div>
            </div>
          </div>
          <div class="content-card" data-step="1">
            <div class="card-content question-card-content">
              <div class="step-indicator">2/2</div>
              <h3 class="section-heading">Lower activity in industrialized societies?</h3>
              <p class="card-text">
                A common hypothesis is that industrialized countries are less physically active than traditional farming or foraging groups, and that activity levels may have changed as societies modernized. According to a 2006 survey, many Americans believe reduced activity is the primary reason people are overweight. <a href="#source-2" class="footnote-link">[2]</a>
              </p>
              <div id="belief-result" class="result-message"></div>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="combined-question-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="combined-question-section">Next →</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Bridging Text Section -->
    <section id="bridge-section" class="conclusion-section">
      <div class="conclusion-content">
        <h2 class="conclusion-heading">Testing the Activity Hypothesis</h2>
        <p class="conclusion-text">
          To test whether reduced physical activity explains obesity differences across populations, we need data that directly measures energy expenditure. Fortunately, a recent cross-cultural study provides exactly that—tracking total daily energy expenditure across 34 populations ranging from hunter-gatherer societies to industrialized nations.
        </p>
        <p class="conclusion-text">
          The following visualizations explore whether activity levels systematically differ across economic development categories, and whether those differences align with patterns in body fat percentage.
        </p>
        <div class="nav-buttons" style="margin-top: 30px;">
          <button class="nav-btn prev-btn" data-section="bridge-section">← Previous</button>
          <button class="nav-btn next-btn" data-section="bridge-section">Next →</button>
        </div>
      </div>
    </section>

    <!-- Inactivity Bar Chart Section -->
    <section id="inactivity-section" class="graph-section">
      <div class="split-layout">
        <div class="graph-side">
          <div class="chart-wrapper">
            <div class="chart-header">
              <h3 class="chart-title" id="inactivity-chart-title">Total test energy expenditure (TEE) by Economy Type</h3>
            </div>
            <div id="inactivity-chart"></div>
            <div class="chart-controls-row" id="unified-controls-container" style="display: none;">
              <div class="unified-controls">
                <div class="control-row">
                  <div class="control-item">
                    <label class="control-label-small">Y-axis:</label>
                    <select id="unified-y-select" class="unified-select">
                      <option value="TEE">Total Energy Expenditure (TEE) MJ/day</option>
                      <option value="PAL">Physical Activity Level (PAL)</option>
                      <option value="PercUPF">Percentage of Energy Intake from Ultra-processed Foods</option>
                      <option value="Fat" selected>Body Fat Percentage</option>
                    </select>
                  </div>
                  <div class="control-item">
                    <label class="control-label-small">Sex:</label>
                    <div class="sex-toggle">
                      <label class="toggle-label">
                        <input type="checkbox" id="unified-male-cb" checked>
                        <span>M</span>
                      </label>
                      <label class="toggle-label">
                        <input type="checkbox" id="unified-female-cb" checked>
                        <span>F</span>
                      </label>
                    </div>
                  </div>
                  <div class="control-item">
                    <label class="control-label-small">X-axis:</label>
                    <select id="unified-x-select" class="unified-select">
                      <option value="Economy_Type">Economy Type</option>
                      <option value="HDI_rank" selected>Human Development Index (HDI) Rank</option>
                      <option value="TEE">Total Energy Expenditure (TEE) MJ/day</option>
                      <option value="PAL">Physical Activity Level (PAL)</option>
                      <option value="PercUPF">Percentage of Energy Intake from Ultra-processed Foods</option>
                      <option value="Fat">Body Fat Percentage</option>
                    </select>
                  </div>
                  <div class="control-item" id="chart-type-control" style="display: none;">
                    <label class="control-label-small">View:</label>
                    <div class="view-tabs-wrapper">
                      <div class="view-tabs">
                        <button class="view-tab active" data-view="box" id="box-view-btn">Box</button>
                        <button class="view-tab" data-view="scatter" id="scatter-view-btn">Scatter</button>
                      </div>
                      <div class="disabled-tooltip" id="view-disabled-tooltip">Select "Economy (HDI)" as X-axis to enable box plot view</div>
                    </div>
                  </div>
                </div>
                <div class="control-row">
                  <div class="population-selector-control">
                    <label class="control-label-small">Highlight populations:</label>
                    <div class="population-selector-wrapper">
                      <select id="population-select" class="unified-select population-select">
                        <option value="">Select to highlight...</option>
                      </select>
                      <div class="selected-populations" id="selected-populations"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="content-side">

          <div class="content-card active" data-step="0">
            <div class="card-content">
              <div class="step-indicator">1/5</div>
              <h4 class="card-title">Data collection and Filtering</h4>
              <p class="card-text">
                The map to the left shows where data was collected from the <b>34 different populations</b>. Each point represents a population group, color-coded by their economic development level according to the Human Development Index (HDI).
              </p>
              <p class="card-text">
                The research team had an initial dataset of 10,590 adults, and filtered for participants with known sex and no health conditions, removed athletes, and focused on ages 18-60. This left <b>4,213 adults</b>. These groups ranged from hunter-gatherer and small-scale farming communities to fully industrialized societies.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="inactivity-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="inactivity-section">Next →</button>
              </div>
              <div class="skip-link-container">
                <a href="#" class="skip-link" data-target-step="4">Skip to interactive graph →</a>
              </div>
            </div>
          </div>
          <div class="content-card" data-step="1">
            <div class="card-content">
              <div class="step-indicator">2/5</div>
              <h4 class="card-title">Body fat by HDI rank</h4>
              <p class="card-text">
                When we plot <strong>body fat percentage by HDI rank</strong> (where lower rank = higher development), we see a clear relationship: populations from more developed countries (lower HDI rank numbers) tend to have higher body fat percentages.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="inactivity-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="inactivity-section">Next →</button>
              </div>
              <div class="skip-link-container">
                <a href="#" class="skip-link" data-target-step="4">Skip to interactive graph →</a>
              </div>
            </div>
          </div>

          <div class="content-card" data-step="2">
            <div class="card-content">
              <div class="step-indicator">3/5</div>
              <h4 class="card-title">Body fat vs Physical Activity Level (PAL)</h4>
              <p class="card-text">
                Is there a relationship between physical activity and body fat? When we plot <strong>body fat % vs PAL</strong>, we see a weak relationship: higher physical activity levels do not consistently predict lower body fat percentages across populations.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="inactivity-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="inactivity-section">Next →</button>
              </div>
              <div class="skip-link-container">
                <a href="#" class="skip-link" data-target-step="4">Skip to interactive graph →</a>
              </div>
            </div>
          </div>

          <div class="content-card" data-step="3">
            <div class="card-content">
              <div class="step-indicator">4/5</div>
              <h4 class="card-title">Body fat vs Ultra-Processed Food (UPF)</h4>
              <p class="card-text">
                Here's where the pattern becomes clearer. When we plot <strong>body fat % vs UPF intake</strong>, we see a stronger, more consistent relationship: populations with higher ultra-processed food consumption tend to have higher body fat percentages. This data was available for 25 of the 34 populations.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="inactivity-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="inactivity-section">Next →</button>
              </div>
              <div class="skip-link-container">
                <a href="#" class="skip-link" data-target-step="4">Skip to interactive graph →</a>
              </div>
            </div>
          </div>

          <div class="content-card" data-step="4">
            <div class="card-content">
              <div class="step-indicator">5/5</div>
              <h4 class="card-title">Explore the data</h4>
              <p class="card-text">
                Use the controls above to explore different relationships in the data. Select which variables to plot, filter by sex, and search for specific populations to highlight.
              </p>
              <div class="nav-buttons">
                <button class="nav-btn prev-btn" data-section="inactivity-section">← Previous</button>
                <button class="nav-btn next-btn" data-section="inactivity-section">Next →</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>


    <!-- Conclusion Section -->
    <section id="conclusion-section" class="conclusion-section">
      <div class="conclusion-content">
        <h2 class="conclusion-heading">Conclusion</h2>
        <p class="conclusion-text">
          Taken together, these results point to a clearer picture of how obesity varies across populations. Physical activity levels, once adjusted for body size, show only modest differences across economic settings. This makes it unlikely that shifts in daily movement alone explain why some populations have much higher obesity rates than others. The limited dietary data show a more consistent pattern: populations with higher intake of ultra-processed foods tend to have higher body-fat percentages. While this does not prove causation, it suggests that differences in diet composition may help explain variation in obesity more than differences in activity.
        </p>

        <h2 class="conclusion-heading">Why this matters</h2>
        <p class="conclusion-text">
          Understanding which factors align more closely with obesity has direct implications for public health messaging, policy, and resource allocation. If physical activity is only weakly linked to population-level differences in obesity, strategies that rely heavily on encouraging people to "move more" may have limited impact on reducing national obesity levels. In contrast, if dietary patterns—particularly the availability and consumption of ultra-processed foods—show stronger and more consistent associations, then interventions focused on food environments, regulation, and access may be more effective. For policymakers and health organizations, distinguishing between these explanations is essential for designing approaches that match the scale and nature of the problem.
        </p>

        <h2 class="conclusion-heading">Limitations</h2>
        <p class="conclusion-text">
          Several limitations of the dataset and analysis should be noted.
        </p>
        <p class="conclusion-text">
          <strong>Population means only:</strong> The publicly available data include only population-level averages, not individual measurements. This limits the ability to examine within-population variation or model individual-level predictors.
        </p>
        <p class="conclusion-text">
          <strong>Cross-sectional comparisons:</strong> The data compare different populations at one point in time. They do not track changes within the same populations over time, making it difficult to infer temporal trends in activity or diet.
        </p>
        <p class="conclusion-text">
          <strong>Heterogeneous dietary methods:</strong> UPF values were compiled from a variety of published sources. Different studies used different dietary assessment tools—such as 24-hour recalls, food-frequency questionnaires, or national surveys—which introduces variability in how UPF intake was measured.
        </p>
        <p class="conclusion-text">
          <strong>Limited diet coverage:</strong> Dietary information was available for only 25 of the 34 populations. Important comparisons may be missing, and results may not generalize to all groups in the dataset.
        </p>
        <p class="conclusion-text">
          <strong>Observational data:</strong> The associations reported here, including those between UPF and body fat, are correlational. They cannot determine causation or rule out unmeasured variables.
        </p>
        <p class="conclusion-text">
          <strong>Energy-expenditure constraints:</strong> TEE, AEE, and PAL estimates come from different studies and field methods. While doubly labeled water is the gold standard for TEE, its use varies across populations, and methods for estimating PAL differ.
        </p>
        <p class="conclusion-text">
          These limitations do not undermine the core patterns observed, but they clarify the scope of what the data can support. The results highlight the need for more consistent dietary data and longitudinal measurements of energy balance, particularly in rapidly industrializing settings.
        </p>

        <h2 class="conclusion-heading">Sources</h2>
        <p class="sources-text" id="source-1">
          <span class="source-number">[1]</span> Pontzer, Herman, et al. "Energy Expenditure, Dietary Energy Intake, and Body Composition Across Populations." <em>Proceedings of the National Academy of Sciences</em>, vol. 122, no. 3, 2025, e2420902122. <em>PNAS</em>, <a href="https://doi.org/10.1073/pnas.2420902122" target="_blank" rel="noopener noreferrer">https://doi.org/10.1073/pnas.2420902122</a>.
        </p>
      </div>
    </section>
  </div>

  <script type="module" src="./js/data.js"></script>
  <script type="module" src="./js/charts.js"></script>
  <script type="module" src="./js/scroll.js"></script>
  <script type="module" src="./js/interactions.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
